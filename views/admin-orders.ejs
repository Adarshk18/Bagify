<%- include('partials/header') %>

<div class="container my-5">
  <h2 class="mb-4">ðŸ“¦ All Orders</h2>

  <% if (orders.length === 0) { %>
    <div class="alert alert-info">No orders found.</div>
  <% } else { %>
    <% orders.forEach(order => { %>
      <div class="card shadow-sm mb-4 border-0">
        <div class="card-body">
          <!-- ðŸ§ User Info -->
          <div class="d-flex justify-content-between align-items-center mb-2">
            <div>
              <h5 class="mb-1">ðŸ‘¤ <%= order.user.fullname %> (<%= order.user.email %>)</h5>
              <p class="mb-0 text-muted">Order ID: <%= order._id %></p>
            </div>
            <span class="badge 
              <% if (order.status === 'Pending') { %> bg-warning 
              <% } else if (order.status === 'Shipped') { %> bg-info 
              <% } else if (order.status === 'Out for Delivery') { %> bg-primary 
              <% } else if (order.status === 'Delivered') { %> bg-success 
              <% } else if (order.status === 'Cancelled') { %> bg-danger 
              <% } else { %> bg-secondary <% } %> 
              fs-6">
              <%= order.status %>
            </span>
          </div>

          <!-- ðŸ›ï¸ Products List -->
          <ul class="list-group mb-3">
            <% order.products.forEach(p => { %>
              <li class="list-group-item d-flex justify-content-between align-items-center">
                <strong><%= p.product.name %></strong>
                <span>Qty: <%= p.quantity %></span>
              </li>
            <% }) %>
          </ul>

          <!-- ðŸ’° Total & Status Update -->
          <div class="d-flex justify-content-between align-items-center">
            <h5 class="mb-0">ðŸ’° Total: â‚¹<%= order.totalAmount %></h5>

            <form action="/admin/orders/update/<%= order._id %>" method="POST" class="d-flex align-items-center gap-2">
              <select name="status" class="form-select form-select-sm">
                <% const statuses = ['Pending', 'Shipped', 'Out for Delivery', 'Delivered', 'Cancelled']; %>
                <% statuses.forEach(stat => { %>
                  <option value="<%= stat %>" <%= order.status === stat ? 'selected' : '' %>>
                    <%= stat %>
                  </option>
                <% }) %>
              </select>
              <button type="submit" class="btn btn-sm btn-primary">Update</button>
            </form>
          </div>
        </div>
      </div>
    <% }) %>
  <% } %>
</div>

<%- include('partials/footer') %>
