<%- include('./partials/header') %>

<div class="px-6 py-10 min-h-screen bg-gray-50 max-w-5xl mx-auto">
  <h2 class="text-3xl font-bold mb-8 text-gray-800">ğŸ“¦ My Orders</h2>

  <% if (orders.length === 0) { %>
    <div class="text-center py-20 bg-white shadow rounded">
      <img src="/images/no-orders.png" class="w-40 mx-auto mb-6" alt="No orders" />
      <p class="text-gray-600 mb-2 text-lg">No orders found.</p>
      <a href="/shop" class="text-blue-600 hover:underline">â† Go to Shop</a>
    </div>
  <% } else { %>
    <div class="space-y-6">
      <% orders.forEach(order => { %>
        <div class="border rounded-md p-5 shadow-sm <%= order.status === 'Cancelled' ? 'bg-gray-100 text-gray-500 line-through' : 'bg-white' %>">
          
          <!-- ğŸ†” Order Info -->
          <div class="flex justify-between items-center mb-4">
            <div>
              <p class="text-sm text-gray-500 font-mono">ğŸ†” <%= order._id %></p>
              <p class="text-xs text-gray-400">ğŸ“… <%= new Date(order.createdAt).toLocaleString() %></p>
              
              <% if (order.paymentMethod) { %>
                <p class="text-xs text-gray-600">
                  ğŸ’³ Payment Mode: <%= order.paymentMethod %>
                </p>
              <% } %>
              
              <% if (order.paymentStatus) { %>
                <p class="text-xs font-semibold <%= order.paymentStatus === 'Paid' ? 'text-green-600' : 'text-yellow-600' %>">
                  ğŸ’° Status: <%= order.paymentStatus %>
                </p>
              <% } %>
            </div>

            <span
              class="px-3 py-1 rounded-full text-xs font-semibold
              <%= order.status === 'Paid' ? 'bg-green-100 text-green-700'
                : order.status === 'Shipped' ? 'bg-blue-100 text-blue-700'
                : order.status === 'Out for Delivery' ? 'bg-indigo-100 text-indigo-700'
                : order.status === 'Delivered' ? 'bg-green-100 text-green-700'
                : order.status === 'Cancelled' ? 'bg-red-100 text-red-600'
                : 'bg-yellow-100 text-yellow-800' %>">
              <%= order.status %>
            </span>
          </div>

          <!-- ğŸ‘œ Ordered Products -->
          <ul class="text-sm mb-3 space-y-1">
            <% order.products.forEach(item => { 
              const product = item.product; 
              if (!product) { %>
                <li class="flex items-center gap-2 text-gray-500 italic">
                  ğŸ‘œ [Product Removed] Ã— <%= item.quantity %>
                </li>
            <% return; } %>

            <li class="flex items-center gap-2">
              <% if (product.image) { %>
                <img src="<%= product.image %>" alt="Product image" class="w-10 h-10 object-contain border" />
              <% } %>
              <div>
                ğŸ‘œ <span class="font-medium"><%= product.name %></span><br />
                Ã— <%= item.quantity %> â€” â‚¹ <%= product.price %> each
              </div>
            </li>
            <% }) %>
          </ul>

          <!-- ğŸ’¸ Total -->
          <div class="text-right text-green-700 font-bold mb-3">
            Total: â‚¹ <%= order.totalAmount %>
          </div>

          <!-- ğŸ  Delivery Address -->
          <% if (order.address) { %>
            <div class="mt-3 border-t pt-3 text-sm text-gray-700">
              <p class="font-semibold mb-1">ğŸ  Delivery Address:</p>
              <p><%= order.address.fullname %> (<%= order.address.phone %>)</p>
              <p>
                <%= order.address.street %>, <%= order.address.city %> - <%= order.address.pincode %><br />
                <%= order.address.state %>, <%= order.address.country %>
              </p>
              <% if (order.address.landmark) { %>
                <p>ğŸ“ Landmark: <%= order.address.landmark %></p>
              <% } %>
            </div>
          <% } %>

          <!-- ğŸ§­ Delivery Progress -->
          <div class="mt-4">
            <div class="flex justify-between text-xs text-gray-600 font-medium mb-1">
              <span>Pending</span>
              <span>Shipped</span>
              <span>Out for Delivery</span>
              <span>Delivered</span>
            </div>
            <div class="flex h-2 bg-gray-200 rounded overflow-hidden">
              <% const statusSteps = ['Pending', 'Shipped', 'Out for Delivery', 'Delivered']; %>
              <% const currentStep = statusSteps.indexOf(order.status); %>
              <% statusSteps.forEach((step, idx) => { %>
                <div class="<%= idx <= currentStep ? 'bg-blue-500' : 'bg-gray-300' %> flex-1 transition-all duration-300"></div>
              <% }) %>
            </div>
          </div>

          <!-- âŒ Cancel Button -->
          <% if (order.status === 'Pending') { %>
            <form action="/orders/cancel/<%= order._id %>" method="POST" onsubmit="return confirm('Are you sure to cancel this order?');">
              <button class="mt-3 text-red-600 hover:underline text-sm" type="submit">
                Cancel Order
              </button>
            </form>
          <% } %>

        </div>
      <% }) %>
    </div>
  <% } %>
</div>

<%- include('./partials/footer') %>
