<%- include('./partials/header') %>

  <div class="min-h-screen bg-gray-50 px-6 py-10">
    <div class="flex flex-col lg:flex-row gap-10">
      <!-- Sidebar -->
      <!-- Sidebar -->
      <aside class="w-full lg:w-1/4 space-y-6">
        <!-- Sort By Card -->
        <div class="bg-white dark:bg-gray-900 p-5 rounded-xl shadow-md">
          <h3 class="text-lg font-semibold mb-3 text-gray-800 dark:text-gray-200">Sort by</h3>
          <form action="/shop" method="GET">
            <select name="sortby" onchange="this.form.submit()"
              class="w-full border border-gray-300 rounded px-4 py-2 focus:ring-2 focus:ring-blue-400 transition shadow-sm">
              <option value="">Default</option>
              <option value="price_asc">Price: Low to High</option>
              <option value="price_desc">Price: High to Low</option>
            </select>
          </form>
        </div>

        <!-- Categories Card -->
        <div class="bg-white p-5 rounded-xl shadow-md">
          <h3 class="text-lg font-semibold mb-3 text-gray-800">Categories</h3>
          <ul class="space-y-2 text-sm">
            <li>
              <a href="/shop" class="block px-3 py-2 rounded hover:bg-blue-50 hover:text-blue-600 transition">
                All Products
              </a>
            </li>
            <li>
              <a href="/shop?discount=yes"
                class="block px-3 py-2 rounded hover:bg-blue-50 hover:text-blue-600 transition">
                Discounted Products
              </a>
            </li>
          </ul>
        </div>
      </aside>


      <!-- Main Content -->
      <main class="w-full lg:w-3/4">
        <!-- Flash Messages -->
        <% if (error && error.length> 0) { %>
          <div id="flash-error"
            class="fixed top-5 left-1/2 -translate-x-1/2 bg-red-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center justify-between z-50 animate-fadeIn">
            <span>
              <%= error[0] %>
            </span>
            <button onclick="document.getElementById('flash-error').remove()" class="text-white text-xl leading-none">
              &times;
            </button>
          </div>
          <% } %>
            <% if (success && success.length> 0) { %>
              <div id="flash-success"
                class="fixed top-5 left-1/2 -translate-x-1/2 bg-green-500 text-white px-6 py-3 rounded-lg shadow-lg flex items-center justify-between z-50 animate-fadeIn">
                <span>
                  <%= success[0] %>
                </span>
                <button onclick="document.getElementById('flash-success').remove()"
                  class="text-white text-xl leading-none">
                  &times;
                </button>
              </div>
              <% } %>

                <script>
                  setTimeout(() => {
                    document.getElementById("flash-error")?.remove();
                    document.getElementById("flash-success")?.remove();
                  }, 4000);
                </script>

                <!-- Search Bar -->
                <form action="/products/shop" method="GET" class="mb-6 flex items-center gap-2">
                  <input type="text" name="search" placeholder="Search products..."
                    value="<%= typeof search !== 'undefined' ? search : '' %>" class="w-full border border-gray-300 dark:border-gray-700 
                    px-4 py-2 rounded-full focus:outline-none focus:ring-2 focus:ring-blue-400 shadow-sm transition" />
                  <button type="submit"
                    class="bg-blue-600 text-white px-4 py-2 rounded-full hover:bg-blue-700 transition">
                    <i class="ri-search-line text-xl"></i>
                  </button>
                </form>

                <% if (products.length===0) { %>
                  <div class="text-center text-gray-500 mt-20">No products found.</div>
                  <% } %>

                    <!-- Products Grid -->
                    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-8">
                      <% products.forEach(function(product) { %>
                        <div
                          class="bg-white rounded-xl shadow-md overflow-hidden hover:shadow-xl transition-transform hover:scale-105 relative group">
                          <% if (product.discount> 0 && product.originalPrice &&
                            product.originalPrice > product.price) { const discountPercent =
                            Math.round((product.discount / product.originalPrice) * 100); %>
                            <span
                              class="absolute top-3 left-3 bg-gradient-to-r from-red-500 to-pink-500 text-white text-xs px-3 py-1 rounded-full shadow-lg z-10">
                              <%= discountPercent %>% OFF
                            </span>
                            <% } %>

                              <a href="/products/<%= product._id %>">
                                <div class="flex items-center justify-center h-48 bg-gradient-to-br ...">
                                  <img
                                    src="<%= (product.images && product.images.length > 0 ? (product.images[0].startsWith('/images') ? product.images[0] : '/images/' + product.images[0]) : (product.image ? (product.image.startsWith('/images') ? product.image : '/images/' + product.image) : '/images/default-avatar.png')) %>"
                                    alt="<%= product.name %>"
                                    class="h-full object-contain p-4 transition-transform group-hover:scale-110" />

                                </div>
                              </a>


                              <div class="p-4" style="
              background-color: <%= product.panelcolor %>;
              color: <%= product.textcolor %>;
            ">
                                <h3 class="font-semibold text-lg mb-1">
                                  <%= product.name %>
                                </h3>
                                <div class="flex items-center justify-between text-sm">
                                  <span class="text-lg font-semibold">₹<%= product.price %></span>
                                  <% if (product.discount> 0) { %>
                                    <span class="line-through text-gray-400">
                                      ₹<%= parseInt(product.price) + parseInt(product.discount) %>
                                    </span>
                                    <% } %>
                                </div>

                                <div class="mt-3 flex justify-between items-center">
                                  <% if (user) { %>
                                    <form action="/cart/add/<%= product._id %>" method="POST" class="inline">
                                      <button type="submit"
                                        class="bg-gradient-to-r from-red-500 to-pink-500 text-white p-2 rounded-full shadow-lg hover:scale-110 transition">
                                        <i class="ri-shopping-cart-2-line text-lg"></i>
                                      </button>
                                    </form>

                                    <% } else { %>
                                      <a href="/users"
                                        class="bg-gray-200 text-gray-800 px-4 py-2 rounded-lg hover:bg-gray-300 transition">
                                        Login to Order
                                      </a>
                                      <% } %>
                                </div>
                              </div>
                        </div>
                        <% }) %>
                    </div>
      </main>
    </div>
  </div>

  <%- include('./partials/footer') %>

    <!-- Remix Icons CDN -->
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet" />

    <!-- Optional: Swiper or other scripts remain unchanged -->